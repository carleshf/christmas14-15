<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>A New Christmas Card</title>
  <style>
    * { padding: 0; margin: 0; }
    canvas { background: #eee; display: block; margin: 0 auto; }
  </style>
</head>
<body>
  <canvas id="myCanvas" width="800" height="600"></canvas>
	<script>
		var canvas = document.getElementById("myCanvas")
		var context = canvas.getContext("2d")
    /* ----------------------------------------------------------------- */
    var app_color = '#eeeeee'

    function getColor(char, dft) {
      switch(char) {
        case 'b':
          return('#993333')
        case 'w':
          return('#FFFFFF')
        case 'G':
          return('#404040')
        case '#':
          return(dft)
        default:
          return('red')
      }
    }
    /* ----------------------------------------------------------------- */
    class Map {
      constructor() {
        this.current = null
      }

      addItem(item) {
        this[item.id] = item
      }

      drawTravel(x, y, ctx) {
        let options = []
        for(let ii = 0; ii < this[this.current].connections.length; ii++) {
          let id = this[this.current].connections[ii]
          let x = new MenuOption(this[id]['city'] + ' (' + this[id]['country'] + ')')
          options.push(x)
        }
        let display = new Menu(x, y, options)

        display.setVertical()
        display.hideTitle()
        display.setBoxSize(410, 25, 8, 4)
        display.draw(context)
      }
    }
    /* ----------------------------------------------------------------- */
    class TimeTraker {
      constructor(x, y, days, slots, width) {
        this.x = x
        this.y = y
        this.allowed_days = days;
        this.used_days = 0
        this.allowed_slots = slots
        this.used_slots = 0
        this.width = width
        this.offset_x = 8
        this.width = (this.width - this.offset_x * (this.allowed_slots - 2)) / this.allowed_slots
        this.height = 10
      }

      addTime() {
        this.used_days += 1
        this.used_slots = Math.floor(this.used_days * this.allowed_slots / this.allowed_days )
      }

      draw(ctx) {
        ctx.font = "12px Arial";
        ctx.fillStyle = 'black'
        ctx.fillText('Time tracker ' + '.'.repeat(192), this.x, this.y - 3)


        let iterative_x = this.x
        for(let ii = 0; ii < this.allowed_slots; ii++) {
          ctx.fillStyle = 'black'
          ctx.fillRect(iterative_x - 1, this.y - 1, this.width + 2, this.height + 2)
          if(ii < this.used_slots) {
            ctx.fillStyle = 'pink'
          } else {
            ctx.fillStyle = 'lightgray'
          }
          ctx.fillRect(iterative_x, this.y, this.width, this.height)

          iterative_x += this.width + this.offset_x
        }
      }
    }

    /* ----------------------------------------------------------------- */
    class MenuOption {
      constructor(text, picture) {
        this.text = text
        this.picture = picture
        this.x = null
        this.y = null
      }

      setCoordinates(x, y) {
        this.x = x
        this.y = y
      }

      _drawPicture(ctx, dft, w) {
        let sz = 4
        let row = 0
        let col = 0
        let px = this.x + (w / 2) - (6 * sz / 2)
        let py = this.y + 30
        this.picture.forEach( (it) => {
          ctx.fillStyle = getColor(it, dft)
          let x = px + sz * row
          let y = py + sz * col
          ctx.fillRect(x, y, sz, sz)

          col += 1
          if(col % 6 == 0) {
            col = 0
            row += 1
          }
        })
      }

      draw(ctx, px, w, h, draw_picture) {
        ctx.font = px + "px Courier New";
        ctx.fillStyle = 'black'
        ctx.fillRect(this.x, this.y, w, h)
        ctx.fillStyle = 'lightgray'
        ctx.fillRect(this.x + 1, this.y + 1, w - 2, h - 2)
        ctx.fillStyle = 'black'
        
        let tx = this.x + (w / 2) - (ctx.measureText(this.text).width / 2)

        ctx.fillText(this.text, tx, this.y + px + 2)

        if(draw_picture) {
          if(this.picture !== undefined) {
            this._drawPicture(ctx, 'lightgray', w)
          }
        }
      }

      clicked(x, y, w, h) {
        let test_x = x > this.x & x < this.x + w
        let test_y = y > this.y & x < this.y + h
        //console.log('(', x, ', ', y, ') -> (', this.x, ', ', this.y, ', ', this.x + w, ', ', this.y + h, ') -> ', test_x, ' / ', test_y)
        return test_x & test_y
      }
    }

    class Menu {
      constructor(x, y, options) {
        this.x = x
        this.y = y
        this.width = 125
        this.height = 75
        this.options = options
        this.offset_x = 8
        this.offset_y = 4
        this.px = 15
        this.orientation = 'horizontal'
        this.show_title = true
        this.pulse = []
      }

      setVertical() {
        this.orientation = 'vertical'
      }

      setHorizontal() {
        this.orientation = 'horizontal'
      }

      showTitle() {
        this.show_title = true
      }

      hideTitle() {
        this.show_title = false
      }

      setBoxSize(w, h, ox, oy) {
        this.width = w
        this.height = h
        this.offset_x = ox
        this.offset_y = oy
      }

      draw(ctx) {
        if(this.show_title) {
          ctx.font = "12px Arial";
          ctx.fillStyle = 'black'
          ctx.fillText('Menu ' + '.'.repeat(112), this.x, this.y - 3)
        }

        if(this.orientation == 'horizontal') {
          let iterative_x = this.x
          for(let ii = 0; ii < this.options.length; ii++) {
            this.options[ii].setCoordinates(iterative_x, this.y)
            this.options[ii].draw(ctx, this.px, this.width, this.height, true)
            let txt = this.options[ii].text
            
            iterative_x += this.width + this.offset_x * 2
          }
        } else { // 'vertical'
          let iterative_y = this.y
          for(let ii = 0; ii < this.options.length; ii++) {
            this.options[ii].setCoordinates(this.x, iterative_y)
            this.options[ii].draw(ctx, this.px, this.width, this.height, false)
            let txt = this.options[ii].text
            
            iterative_y += this.height + this.offset_y * 2
          }
        }
      }

      addPulse(pos, fun) {
        this.pulse[pos] = fun
      }

      checkButtons(x, y, ctx) {
        let pos = this.options.map( (it) => it.clicked(x, y, this.width, this.height) )
        if(pos.indexOf(1) != -1) {
          this.pulse[pos.indexOf(1)](ctx)
        }
      }
    }
    /* ----------------------------------------------------------------- */
    function create_map() {
      let europe_small_map = [ 
        {'id': 'es_bcn', 'country': 'Spain', 'city': 'Barcelona',
          'connections': ['fr_par', 'uk_lnd', 'it_mil']},
        {'id': 'fr_par', 'country': 'France', 'city': 'Paris',
          'connections': ['es_bcn', 'dk_chp', 'de_bln']},
        {'id': 'uk_lnd', 'country': 'United Kingdom', 'city': 'London',
          'connections': ['es_bcn', 'ie_dub', 'de_bln']},
        {'id': 'dk_chp', 'country': 'Denmark', 'city': 'Copenhagen',
          'connections': ['fr_par', 'de_bln']},
        {'id': 'de_bln', 'country': 'Germany', 'city': 'Berlin',
          'connections': ['dk_chp', 'fr_par', 'uk_lnd']},
        {'id': 'it_mil', 'country': 'Italy', 'city': 'Milan',
          'connections': ['es_bcn', 'gr_ath', 'hn_dbv']},
        {'id': 'gr_ath', 'country': 'Greece', 'city': 'Athena',
          'connections': ['hn_dbv', 'it_mil']},
        {'id': 'hn_dbv', 'country': 'Croatia', 'city': 'Dubrovnik',
          'connections': ['gr_ath', 'it_mil']},
        {'id': 'ie_dub', 'country': 'Ireland', 'city': 'Dublin',
          'connections': ['uk_lnd']}
      ]

      let map = new Map()
      for(let ii = 0; ii < europe_small_map.length; ii++) {
        map.addItem(europe_small_map[ii])
      }
      map.current = 'uk_lnd'
      return map
    }

    function createMainMenu(x = 10, y = 20) {
      let options = [{'text': 'Travel'}, {
        'text': 'Search', 'picture': ['#', 'G', 'G', '#', '#', '#', 'G', 'w', 'w', 'G', '#', '#', 'G', 'w', 'w', 'G', '#', '#', '#', 'G', 'G', 'b', '#', '#', '#', '#', '#', '#', 'b', '#', '#', '#', '#', '#', '#', 'b']}, 
        {'text': 'Data'}]
      options = options.map( (op) => new MenuOption(op.text, op.picture))
      return new Menu(x, y, options)  
    }

    function showTravelMenu(ctx) {
      game_map.drawTravel(375, 375, ctx)
    }

    /* ----------------------------------------------------------------- */
    let game_map = create_map()
    let time_traker = new TimeTraker(35, 20, 9, 25, 700)
    time_traker.draw(context)
    let main_menu = createMainMenu(375, 500)
    main_menu.setHorizontal()
    main_menu.showTitle()
    main_menu.addPulse(0, showTravelMenu)
    main_menu.draw(context)

    /* ----------------------------------------------------------------- */

    /* ----------------------------------------------------------------- */ 
    document.addEventListener("click", onClick, false);   
    function onClick(e) {
      let mX = event.pageX - canvas.offsetLeft;
      let mY = event.pageY - canvas.offsetTop;
      console.log('onClick: (', mX, ', ', mY, ')')
      main_menu.checkButtons(mX, mY, context);
    }
  </script>
</body>
</html>